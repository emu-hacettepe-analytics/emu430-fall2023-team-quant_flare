---
title: "Analysis"
---

First of all, we generated the data that would be useful to us from TURKSTAT's website. After downloading the data as an Excel file, we changed the positions of the columns and raws, making it easier to work on it. Next, we anchored the rows and columns of the data so that R could read them. Finally, we created column headings for the cities.\
\
Loading necessary libraries :

```{r, message=FALSE, results='asis'}
#| warning: false
#| code-summary: "Show the code"
#| code-fold: true

library(readxl)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(knitr)
library(ggrepel)
library(reshape2)
library(gridExtra)

```

Load the data:

```{r, message=FALSE, results='asis'}
#| warning: false
#| code-summary: "Show the code"
#| code-fold: true

library(readxl)
url <- "https://github.com/emu-hacettepe-analytics/emu430-fall2023-team-quant_flare/raw/master/Foreign_child_by_year.xlsx"
temp_file <- tempfile(fileext = ".xlsx")
download.file(url, temp_file, mode = "wb")
dataset <- read_excel(temp_file)

head(dataset)
str(dataset)

summary(dataset)
```

# EDA ANALYSE

```{r, message=FALSE, results='asis'}
#| warning: false
#| code-summary: "Show the code"
#| code-fold: true

head(dataset)
str(dataset)
summary(dataset)


# Calculating the average values of cities for each year
mean_values <- dataset %>%
  gather(key = "Year", value = "Value", -City) %>%
  group_by(Year) %>%
  summarize(mean_value = mean(Value, na.rm = TRUE))

# Plotting average values
ggplot(mean_values, aes(x = Year, y = mean_value)) +
  geom_line() +
  labs(title = "Average Values of Cities by Years",
       x = "Year",
       y = "Average") +
  theme_minimal()

# Drawing a boxplot of values by city
dataset_long <- melt(dataset, id.vars = "City")
ggplot(dataset_long, aes(x = variable, y = value)) +
  geom_boxplot() +
  labs(title = "Value Distribution of Cities",
       x = "Year",
       y = "Value") +
  theme_minimal()

# Showing ranked values of cities for 2022
dataset_2022 <- dataset %>%
  select(City, `2022`) %>%
  arrange(desc(`2022`))

ggplot(dataset_2022, aes(x = reorder(City, `2022`), y = `2022`)) +
  geom_bar(stat = "identity") +
  labs(title = "Ranked Values of Cities by 2022",
       x = "City",
       y = "Value") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Bring related charts together
grid.arrange(ggplot(mean_values, aes(x = Year, y = mean_value)) +
               geom_line() +
               labs(title = "Average Values of Cities by Years",
                    x = "Year",
                    y = "Average") +
               theme_minimal(),
             ggplot(dataset_long, aes(x = variable, y = value)) +
               geom_boxplot() +
               labs(title = "Value Distributions of Cities",
                    x = "Year",
                    y = "Value") +
               theme_minimal(),
             ggplot(dataset_2022, aes(x = reorder(City, `2022`), y = `2022`)) +
               geom_bar(stat = "identity") +
               labs(title = "Ranked Values of Cities by 2022",
                    x = "City",
                    y = "Value") +
               theme_minimal() +
               theme(axis.text.x = element_text(angle = 45, hjust = 1)),
             ncol = 1)

```
